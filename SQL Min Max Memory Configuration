DECLARE @max_memory INT, @min_memory INT, @os_memory INT, @total_instances INT;
SET @total_instances = 1;
IF
(
    SELECT total_physical_memory_kb / 1024
    FROM sys.dm_os_sys_memory
) < 8000
    SET @os_memory = 2048;
    ELSE
IF
(
    SELECT total_physical_memory_kb / 1024
    FROM sys.dm_os_sys_memory
) < 33000
    SET @os_memory = 4096;
    ELSE
IF
(
    SELECT total_physical_memory_kb / 1024
    FROM sys.dm_os_sys_memory
) < 66000
    SET @os_memory = 8192;
    ELSE
SET @os_memory = 12288;
SET @max_memory = (
                  (
                      SELECT total_physical_memory_kb / 1024
                      FROM sys.dm_os_sys_memory
                  ) - @os_memory) / @total_instances;
SET @min_memory = 0.7 * @max_memory;
SELECT 'Total Server Memory : '+CONVERT(VARCHAR(8), total_physical_memory_kb / 1024) Memory
FROM sys.dm_os_sys_memory
UNION ALL
SELECT 'Max Memory: '+CONVERT(VARCHAR(8), @max_memory)
UNION ALL
SELECT 'Min Memory: '+CONVERT(VARCHAR(8), @min_memory)
UNION ALL
SELECT 'OS Memory: '+CONVERT(VARCHAR(8), @os_memory);
IF
(
    SELECT value_in_use
    FROM SYS.configurations
    WHERE NAME LIKE 'min server memory (MB)'
) <> @min_memory
    EXEC sys.sp_configure
         N'min server memory (MB)',
         @min_memory;
IF
(
    SELECT value_in_use
    FROM SYS.configurations
    WHERE NAME LIKE 'max server memory (MB)'
) <> @max_memory
    EXEC sys.sp_configure
         N'max server memory (MB)',
         @max_memory;
RECONFIGURE WITH OVERRIDE;
GO
