$a = "<style>"
$a = $a + "TABLE{border-width: 1px;border-style: solid;border-color: black;border-collapse: collapse;}"
$a = $a + "TH{border-width: 1px;padding: 0px;border-style: solid;border-color: black;background-color:thistle}"
$a = $a + "TD{border-width: 1px;padding: 0px;border-style: solid;border-color: black;background-color:palegoldenrod}"
$a = $a + "</style>"
 
$instancepath= "D:\Perfmon\SQLServerList.txt"
$outputfilefull = "C:\JobFailures.htm"
  
$filePath = ""
  
$dt = new-object "System.Data.DataTable"
foreach ($instance in get-content $instancepath)
{
$instance
$query = Get-Content "D:\PerfMon\JobFailures.sql"
$cn = new-object System.Data.SqlClient.SqlConnection "server=$instance;database=msdb;Integrated Security=sspi"
$cn.Open()
$sql = $cn.CreateCommand()
$sql.CommandText = $query
$rdr = $sql.ExecuteReader()
$dt.Load($rdr)
$cn.Close()
}
  
$dt | select * -ExcludeProperty RowError, RowState, HasErrors, Name, Table, ItemArray | ConvertTo-Html -head $a | Set-Content $outputfilefull 
 
$filepath = $outputfilefull  
 
$EmailFrom = "MyTeamDL@domain.com"
$emailto = "MyTeamDL@domain.com"
$Subject = "Job Failure report"
$Body = Get-Content ($filepath)
$counting = get-content $filepath | measure -Character -Line -Word
$Body = New-Object System.Net.Mail.MailMessage $Emailfrom, $emailto, $subject, $body
$Body.isBodyhtml = $true
$SMTPServer = "mailrelay.domain.com"
$SMTPClient = New-Object Net.Mail.SmtpClient($SmtpServer) 
if ($counting.words -gt 40)
{
$SMTPClient.Send($Body)
}
