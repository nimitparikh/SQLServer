USE [master];
GO
--Change error log retention from 6 to 26
EXEC xp_instance_regwrite
     N'HKEY_LOCAL_MACHINE',
     N'Software\Microsoft\MSSQLServer\MSSQLServer',
     N'NumErrorLogs',
     REG_DWORD,
     26;
GO
--Keep MSDB job history to 20k rows and max 500 rows per job
USE [msdb];
GO
EXEC msdb.dbo.sp_set_sqlagent_properties
     @jobhistory_max_rows = 20000,
     @jobhistory_max_rows_per_job = 500;
GO
IF NOT EXISTS
(
    SELECT *
    FROM sys.configurations
    WHERE name LIKE 'backup comp%'
          AND value_in_use = 1
)
    BEGIN
        EXEC sp_configure
             'backup compression default',
             1;
        RECONFIGURE WITH OVERRIDE;
END;
GO
USE [msdb]
GO
EXEC msdb.dbo.sp_set_sqlagent_properties 
		@alert_replace_runtime_tokens=1
GO
--https://docs.microsoft.com/en-us/sql/t-sql/database-console-commands/dbcc-traceon-trace-flags-transact-sql
DBCC TRACEON (
3226  --Suppress Successful backup message from errorlog.
,3042 --For large database backup, it will grow as needed.
,1117 --All files in filegroup will grow, mostly used for tempdb optimization but affects all dbs with multiple files.
,1118 --Reduce SGAM contention, in 2016 is controlled by SET MIXED_PAGE_ALLOCATION option of ALTER DATABASE and has no effect.
,4199 --Query Optimizer
,2371 --Auto update statistics algorithm change, in 2016 it has no effect - enabled by default.
,-1)
--DBCC TRACESTATUS
